<!-- /v/index.html — TruthVerify /v Dashboard (GitHub Pages friendly) -->
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="color-scheme" content="dark" />
  <title>TruthVerify /v — Verification Dashboard</title>
  <meta name="description" content="TruthVerify public verification dashboard. Search, filter, and verify creator badges and checks." />

  <style>
    :root{
      --bg:#07080b;
      --panel:#0d1016;
      --border:rgba(255,255,255,.10);
      --text:rgba(255,255,255,.90);
      --muted:rgba(255,255,255,.62);
      --muted2:rgba(255,255,255,.42);
      --gold:#d7b85a;
      --good:#58d08a;
      --warn:#f7c35f;
      --bad:#ff6b6b;
      --shadow: 0 10px 30px rgba(0,0,0,.45);
      --radius: 16px;
      --max: 1080px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Inter, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }
    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family:var(--sans);
      background:
        radial-gradient(1200px 700px at 20% -10%, rgba(215,184,90,.10), transparent 60%),
        radial-gradient(900px 600px at 80% 0%, rgba(255,255,255,.06), transparent 55%),
        radial-gradient(900px 600px at 40% 110%, rgba(215,184,90,.08), transparent 55%),
        var(--bg);
      color:var(--text);
      letter-spacing:.2px;
    }
    a{ color:inherit; text-decoration:none; }
    a:hover{ text-decoration:underline; }

    .wrap{ max-width:var(--max); margin:0 auto; padding:28px 18px 64px; }

    .topbar{
      display:flex; align-items:flex-start; justify-content:space-between;
      gap:16px; margin-bottom:18px;
    }
    .brand{ display:flex; gap:12px; align-items:center; }
    .mark{
      width:44px;height:44px;border-radius:12px;
      background:
        radial-gradient(18px 18px at 30% 30%, rgba(255,255,255,.20), transparent 60%),
        radial-gradient(28px 28px at 70% 60%, rgba(215,184,90,.22), transparent 65%),
        linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.02));
      border:1px solid var(--border);
      box-shadow: var(--shadow);
      position:relative; overflow:hidden;
    }
    .mark:after{
      content:"";
      position:absolute; inset:-40% -30%;
      background: linear-gradient(120deg, transparent 40%, rgba(215,184,90,.20), transparent 60%);
      transform: rotate(10deg);
      opacity:.9;
    }
    .titleblock h1{ margin:0; font-size:18px; line-height:1.2; font-weight:650; }
    .titleblock p{ margin:6px 0 0; font-size:13px; color:var(--muted); max-width:64ch; }

    .actions{ display:flex; align-items:center; gap:10px; flex-wrap:wrap; justify-content:flex-end; }
    .chip{
      display:inline-flex; align-items:center; gap:8px;
      padding:9px 12px; border-radius:999px;
      border:1px solid var(--border);
      background: rgba(255,255,255,.03);
      color:var(--muted);
      font-size:12px;
      cursor:pointer; user-select:none;
    }
    .chip strong{ color:var(--text); font-weight:600; }

    .hero{
      border:1px solid var(--border);
      background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      border-radius: var(--radius);
      padding:16px;
      box-shadow: var(--shadow);
      display:grid;
      gap:12px;
      margin-bottom:18px;
    }

    .controls{
      display:flex; gap:10px; flex-wrap:wrap;
      align-items:center; justify-content:space-between;
    }

    .search{ flex:1 1 320px; position:relative; }
    .search input{
      width:100%;
      padding:12px 12px 12px 38px;
      border-radius: 14px;
      border:1px solid var(--border);
      background: rgba(0,0,0,.25);
      color:var(--text);
      outline:none;
      font-size:14px;
    }
    .search input::placeholder{ color:var(--muted2); }
    .search .icon{
      position:absolute; left:12px; top:50%;
      transform:translateY(-50%);
      opacity:.7; pointer-events:none;
      font-size:14px;
    }

    .filters{ display:flex; gap:10px; flex-wrap:wrap; justify-content:flex-end; }

    .select{
      padding:10px 12px;
      border-radius: 14px;
      border:1px solid var(--border);
      background: rgba(0,0,0,.22);
      color:var(--text);
      outline:none;
      font-size:13px;
      cursor:pointer;
    }

    .btn{
      padding:10px 12px;
      border-radius:14px;
      border:1px solid var(--border);
      background: rgba(255,255,255,.05);
      color:var(--text);
      font-size:13px;
      cursor:pointer;
    }
    .btn:hover{ background: rgba(255,255,255,.07); }
    .btn.gold{
      border-color: rgba(215,184,90,.35);
      background: rgba(215,184,90,.10);
    }
    .btn.gold:hover{ background: rgba(215,184,90,.14); }

    .metaRow{
      display:flex; justify-content:space-between;
      gap:12px; flex-wrap:wrap; align-items:center;
    }
    .metaRow .small{ font-size:12px; color:var(--muted); }
    .mono{ font-family:var(--mono); }

    .grid{ display:grid; grid-template-columns: repeat(12, 1fr); gap:12px; }

    .card{
      grid-column: span 12;
      border:1px solid var(--border);
      background: linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.015));
      border-radius: var(--radius);
      padding:14px;
      box-shadow: 0 8px 20px rgba(0,0,0,.38);
      position:relative; overflow:hidden;
    }
    @media (min-width: 820px){ .card{ grid-column: span 6; } }

    .card:before{
      content:"";
      position:absolute; inset:-1px;
      border-radius:inherit;
      background: radial-gradient(500px 180px at 20% 0%, rgba(215,184,90,.10), transparent 60%);
      pointer-events:none; opacity:.9;
    }

    .cardHeader{
      display:flex; justify-content:space-between; align-items:flex-start;
      gap:10px; margin-bottom:10px; position:relative;
    }

    .badgeTitle{ display:flex; align-items:center; gap:10px; min-width:0; }
    .avatar{
      width:38px;height:38px;border-radius:12px;
      border:1px solid var(--border);
      background:
        radial-gradient(18px 18px at 30% 25%, rgba(255,255,255,.18), transparent 60%),
        radial-gradient(28px 28px at 70% 70%, rgba(215,184,90,.18), transparent 60%),
        rgba(255,255,255,.03);
      flex:0 0 auto;
    }

    .who{ min-width:0; }
    .who .name{
      font-weight:650; font-size:14px;
      white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
    }
    .who .handle{
      margin-top:3px; font-size:12px; color:var(--muted);
      white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
    }

    .status{
      display:inline-flex; align-items:center; gap:7px;
      padding:7px 10px; border-radius:999px;
      border:1px solid var(--border);
      background: rgba(0,0,0,.18);
      font-size:12px; color:var(--muted);
      flex:0 0 auto;
    }
    .dot{ width:8px;height:8px;border-radius:999px; background: var(--warn);
      box-shadow: 0 0 0 4px rgba(247,195,95,.12);
    }
    .status.good .dot{ background: var(--good); box-shadow: 0 0 0 4px rgba(88,208,138,.12); }
    .status.bad  .dot{ background: var(--bad);  box-shadow: 0 0 0 4px rgba(255,107,107,.12); }
    .status.good{ color: rgba(210,255,228,.88); border-color: rgba(88,208,138,.28); background: rgba(88,208,138,.08); }
    .status.bad{ color: rgba(255,220,220,.88); border-color: rgba(255,107,107,.28); background: rgba(255,107,107,.08); }

    .row{ display:flex; gap:10px; flex-wrap:wrap; position:relative; margin-bottom:10px; }
    .pill{
      display:inline-flex; align-items:center; gap:8px;
      padding:7px 10px; border-radius:999px;
      border:1px solid var(--border);
      background: rgba(255,255,255,.03);
      font-size:12px; color:var(--muted);
    }
    .pill b{ color:var(--text); font-weight:600; }

    .kv{
      display:grid;
      grid-template-columns: 110px 1fr;
      gap:8px 10px;
      padding:10px 12px;
      border-radius: 14px;
      background: rgba(0,0,0,.18);
      border:1px solid rgba(255,255,255,.07);
      position:relative;
    }
    .k{ color:var(--muted2); font-size:12px; }
    .v{ color:var(--text); font-size:12px; overflow-wrap:anywhere; }

    .cardFooter{
      display:flex; justify-content:space-between; align-items:center;
      gap:10px; flex-wrap:wrap; margin-top:12px; position:relative;
    }
    .link{
      display:inline-flex; align-items:center; gap:8px;
      padding:9px 10px; border-radius: 12px;
      border:1px solid var(--border);
      background: rgba(255,255,255,.03);
      font-size:12px; color:var(--text);
      cursor:pointer;
    }
    .link:hover{ background: rgba(255,255,255,.06); }

    .hash{ font-family: var(--mono); color: rgba(215,184,90,.85); font-size:12px; }

    .empty{
      border:1px dashed rgba(255,255,255,.18);
      border-radius: var(--radius);
      padding:20px;
      color:var(--muted);
      background: rgba(0,0,0,.18);
      text-align:center;
      grid-column: span 12;
    }

    .footer{
      margin-top:20px;
      color:var(--muted2);
      font-size:12px;
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      justify-content:space-between;
      align-items:center;
    }
    .kbd{
      font-family: var(--mono);
      border:1px solid rgba(255,255,255,.18);
      background: rgba(0,0,0,.25);
      padding:2px 6px;
      border-radius:8px;
      color: rgba(255,255,255,.76);
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="topbar">
      <div class="brand">
        <div class="mark" aria-hidden="true"></div>
        <div class="titleblock">
          <h1>TruthVerify <span class="mono">/v</span> — Verification Dashboard</h1>
          <p>
            A calm, public trust-proof view. Search a creator or badge ID and confirm verification status.
            No hype. Just records.
          </p>
        </div>
      </div>

      <div class="actions">
        <div class="chip" id="chipStatus"><strong id="statCount">0</strong> records loaded</div>
        <div class="chip"><span class="kbd">/</span> search</div>
        <a class="chip" href="../" title="Back to home">Home</a>
      </div>
    </div>

    <section class="hero" aria-label="Controls">
      <div class="controls">
        <div class="search">
          <div class="icon">⌕</div>
          <input id="q" type="search" placeholder="Search by creator, handle, badge ID, platform, or note…" autocomplete="off" />
        </div>

        <div class="filters">
          <select id="platform" class="select" aria-label="Platform filter">
            <option value="">All platforms</option>
            <option value="tiktok">TikTok</option>
            <option value="instagram">Instagram</option>
            <option value="youtube">YouTube</option>
            <option value="x">X</option>
            <option value="web">Web</option>
          </select>

          <select id="status" class="select" aria-label="Status filter">
            <option value="">All statuses</option>
            <option value="verified">Verified</option>
            <option value="pending">Pending</option>
            <option value="revoked">Revoked</option>
          </select>

          <select id="sort" class="select" aria-label="Sort">
            <option value="newest">Sort: Newest</option>
            <option value="oldest">Sort: Oldest</option>
            <option value="creator">Sort: Creator A→Z</option>
          </select>

          <button class="btn" id="reset" type="button">Reset</button>
          <button class="btn gold" id="copyLink" type="button">Copy filtered link</button>
        </div>
      </div>

      <div class="metaRow">
        <div class="small" id="hint">
          Tip: paste a badge ID like <span class="mono">TV-2025-0001</span> or a handle like <span class="mono">@creator</span>.
        </div>
        <div class="small">
          Data source: <span class="mono">/v/data.json</span>
        </div>
      </div>
    </section>

    <main class="grid" id="grid" aria-label="Results"></main>

    <div class="footer">
      <div>© <span id="year"></span> TruthVerify — integrity-first verification</div>
      <div class="mono">v1 • static GitHub Pages friendly</div>
    </div>
  </div>

  <script>
    const DATA_URL = "./data.json";

    // If data.json is missing, we show a tiny fallback so you never see a blank page.
    const FALLBACK = [
      {
        id: "TV-EXAMPLE-0001",
        creator_name: "Example Creator",
        handle: "@example",
        platform: "tiktok",
        status: "verified",
        issued_at: "2025-12-20T18:20:00Z",
        expires_at: "2026-12-20T18:20:00Z",
        verified_url: "./verify.html?id=TV-EXAMPLE-0001",
        notes: "Demo record. Add real records in /v/data.json.",
        hash: "demo"
      }
    ];

    const $ = (sel) => document.querySelector(sel);

    function safeLower(x){ return (x ?? "").toString().toLowerCase(); }
    function normalizePlatform(p){
      const v = safeLower(p).trim();
      if(v === "twitter") return "x";
      return v;
    }

    function formatDate(iso){
      if(!iso) return "—";
      const d = new Date(iso);
      if(Number.isNaN(d.getTime())) return iso;
      return d.toLocaleString(undefined, {
        year:"numeric", month:"short", day:"2-digit",
        hour:"2-digit", minute:"2-digit"
      });
    }

    function statusLabel(s){
      const v = safeLower(s);
      if(v === "verified") return "Verified";
      if(v === "pending") return "Pending";
      if(v === "revoked") return "Revoked";
      return "Unknown";
    }
    function statusClass(s){
      const v = safeLower(s);
      if(v === "verified") return "good";
      if(v === "revoked") return "bad";
      return "";
    }
    function platformLabel(p){
      const v = normalizePlatform(p);
      if(v === "tiktok") return "TikTok";
      if(v === "instagram") return "Instagram";
      if(v === "youtube") return "YouTube";
      if(v === "x") return "X";
      if(v === "web") return "Web";
      return (p || "—");
    }

    function escapeHtml(str){
      return (str ?? "").toString()
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }

    function buildQueryFromState(){
      const params = new URLSearchParams();
      const q = $("#q").value.trim();
      const platform = $("#platform").value;
      const status = $("#status").value;
      const sort = $("#sort").value;
      if(q) params.set("q", q);
      if(platform) params.set("platform", platform);
      if(status) params.set("status", status);
      if(sort && sort !== "newest") params.set("sort", sort);
      const s = params.toString();
      return s ? `?${s}` : "";
    }

    function applyStateFromQuery(){
      const params = new URLSearchParams(location.search);
      $("#q").value = params.get("q") || "";
      $("#platform").value = params.get("platform") || "";
      $("#status").value = params.get("status") || "";
      $("#sort").value = params.get("sort") || "newest";
    }

    function setURLFromState(){
      const qs = buildQueryFromState();
      history.replaceState(null, "", `${location.pathname}${qs}`);
    }

    async function loadData(){
      try{
        const res = await fetch(DATA_URL, { cache: "no-store" });
        if(!res.ok) throw new Error("no data.json");
        const json = await res.json();
        const arr = Array.isArray(json) ? json : (json.records || []);
        return arr.map(r => ({
          ...r,
          platform: normalizePlatform(r.platform),
          status: safeLower(r.status)
        }));
      }catch(e){
        return FALLBACK.map(r => ({
          ...r,
          platform: normalizePlatform(r.platform),
          status: safeLower(r.status)
        }));
      }
    }

    function cardTemplate(r){
      const status = statusLabel(r.status);
      const sClass = statusClass(r.status);
      const plat = platformLabel(r.platform);
      const issued = formatDate(r.issued_at);
      const exp = r.expires_at ? formatDate(r.expires_at) : "—";
      const url = `./verify.html?id=${encodeURIComponent(r.id)}`;
      const hash = r.hash || "—";

      return `
        <article class="card">
          <div class="cardHeader">
            <div class="badgeTitle">
              <div class="avatar" aria-hidden="true"></div>
              <div class="who">
                <div class="name" title="${escapeHtml(r.creator_name || "")}">${escapeHtml(r.creator_name || "—")}</div>
                <div class="handle">${escapeHtml(r.handle || "")}</div>
              </div>
            </div>

            <div class="status ${sClass}">
              <span class="dot" aria-hidden="true"></span>
              <span>${status}</span>
            </div>
          </div>

          <div class="row">
            <div class="pill"><b>Badge</b> <span class="mono">${escapeHtml(r.id || "")}</span></div>
            <div class="pill"><b>Platform</b> ${escapeHtml(plat)}</div>
          </div>

          <div class="kv">
            <div class="k">Issued</div><div class="v">${escapeHtml(issued)}</div>
            <div class="k">Expires</div><div class="v">${escapeHtml(exp)}</div>
            <div class="k">Notes</div><div class="v">${escapeHtml(r.notes || "—")}</div>
          </div>

          <div class="cardFooter">
            <a class="link" href="${escapeHtml(url)}" target="_blank" rel="noopener">
              Open verification page →
            </a>
            <div class="hash" title="Record hash / checksum">${escapeHtml(hash)}</div>
          </div>
        </article>
      `;
    }

    function filterAndSort(all){
      const q = safeLower($("#q").value.trim());
      const platform = $("#platform").value;
      const status = $("#status").value;
      const sort = $("#sort").value;

      let arr = all.slice();

      if(platform){
        arr = arr.filter(r => normalizePlatform(r.platform) === platform);
      }
      if(status){
        arr = arr.filter(r => safeLower(r.status) === status);
      }
      if(q){
        arr = arr.filter(r => {
          const hay = [r.id, r.creator_name, r.handle, r.platform, r.status, r.notes, r.hash]
            .map(safeLower).join(" ");
          return hay.includes(q);
        });
      }

      if(sort === "creator"){
        arr.sort((a,b) => safeLower(a.creator_name).localeCompare(safeLower(b.creator_name)));
      }else if(sort === "oldest"){
        arr.sort((a,b) => new Date(a.issued_at || 0) - new Date(b.issued_at || 0));
      }else{
        arr.sort((a,b) => new Date(b.issued_at || 0) - new Date(a.issued_at || 0));
      }

      return arr;
    }

    function render(records){
      const grid = $("#grid");
      if(!records.length){
        grid.innerHTML = `<div class="empty">No matches. Try clearing filters or searching a shorter term.</div>`;
        return;
      }
      grid.innerHTML = records.map(cardTemplate).join("");
    }

    async function copyText(text){
      try{
        await navigator.clipboard.writeText(text);
        const hint = $("#hint");
        const old = hint.innerHTML;
        hint.textContent = "Copied filtered link.";
        setTimeout(() => { hint.innerHTML = old; }, 1500);
      }catch(e){
        alert("Clipboard blocked by browser. Copy manually from address bar.");
      }
    }

    (async function init(){
      $("#year").textContent = String(new Date().getFullYear());

      applyStateFromQuery();
      const all = await loadData();
      $("#statCount").textContent = String(all.length);

      function refresh(){
        setURLFromState();
        render(filterAndSort(all));
      }

      $("#q").addEventListener("input", refresh);
      $("#platform").addEventListener("change", refresh);
      $("#status").addEventListener("change", refresh);
      $("#sort").addEventListener("change", refresh);

      $("#reset").addEventListener("click", () => {
        $("#q").value = "";
        $("#platform").value = "";
        $("#status").value = "";
        $("#sort").value = "newest";
        refresh();
      });

      $("#copyLink").addEventListener("click", () => {
        const link = `${location.origin}${location.pathname}${buildQueryFromState()}`;
        copyText(link);
      });

      // "/" focuses search (nice on desktop)
      window.addEventListener("keydown", (e) => {
        if(e.key === "/" && document.activeElement !== $("#q")){
          e.preventDefault();
          $("#q").focus();
        }
      });

      refresh();
    })();
  </script>
</body>
</html>
